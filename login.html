<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SmartStock - Secure Login</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        'primary-green': '#10B981',
        'dark-bg': '#0F172A',
        'card-bg': '#1E293B',
      },
      fontFamily: {
        sans: ['Inter', 'sans-serif'],
      },
    }
  }
}
</script>
<style>
body {
  font-family: 'Inter', sans-serif;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  background-color: #0F172A;
}

/* Ghost styling */
.ghost {
  width: 100px;
  height: 100px;
  background: #10B981;
  border-radius: 50% 50% 0 0;
  position: relative;
  margin: 20px auto 40px;
  overflow: hidden;
  box-shadow: 0 5px 15px rgba(16,185,129,0.4);
}
.ghost::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 20px;
  background: #10B981;
  clip-path: polygon(0% 0%, 15% 100%, 30% 0%, 50% 100%, 70% 0%, 85% 100%, 100% 0%);
}
.eye {
  width: 30px;
  height: 30px;
  background: white;
  border-radius: 50%;
  position: absolute;
}
.pupil {
  width: 10px;
  height: 10px;
  background: #0F172A;
  border-radius: 50%;
  position: absolute;
  transition: transform 0.2s;
}
</style>
</head>
<body>
  <div class="w-full max-w-sm">
    <div class="bg-card-bg p-8 rounded-xl shadow-2xl border-t-4 border-primary-green">
      <!-- Ghost -->
      <div class="ghost" id="ghost">
        <div class="eye" id="eyeLeft" style="left:20px;top:20px;">
          <div class="pupil" id="pupilLeft" style="left:10px;top:10px;"></div>
        </div>
        <div class="eye" id="eyeRight" style="left:50px;top:20px;">
          <div class="pupil" id="pupilRight" style="left:10px;top:10px;"></div>
        </div>
      </div>

      <h1 class="text-3xl font-extrabold text-white mb-2 text-center">SmartStock Access</h1>
      <p id="formTitle" class="text-xl font-semibold text-primary-green mb-6 text-center">Login</p>

      <!-- Message -->
      <div id="message-box" class="hidden p-3 mb-4 rounded-lg text-sm font-medium" role="alert"></div>
      <!-- Login Form -->
      <form id="loginForm" onsubmit="handleLogin(event)" class="space-y-4">
        <input id="username" type="text" placeholder="Username" required 
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-green focus:border-primary-green" />
        <input id="password" type="password" placeholder="Password" required 
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-green focus:border-primary-green" />
        <button type="submit" 
          class="w-full py-2 px-4 rounded-md font-medium text-white bg-primary-green hover:bg-emerald-600 transition">
          Login
        </button>
      </form>

      <!-- Register Form -->
      <form id="registerForm" onsubmit="handleRegister(event)" class="space-y-4 hidden">
        <input id="regEmail" type="email" placeholder="Email" required 
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-green focus:border-primary-green" />
        <input id="regUsername" type="text" placeholder="Username" required 
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-green focus:border-primary-green" />
        <input id="regPassword" type="password" placeholder="Password" required 
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-green focus:border-primary-green" />
        <button type="submit" 
          class="w-full py-2 px-4 rounded-md font-medium text-white bg-primary-green hover:bg-emerald-600 transition">
          Register
        </button>
      </form>

      <!-- Toggle -->
      <div class="mt-4 text-center">
        <div class="toggle text-sm cursor-pointer text-gray-400 hover:text-primary-green" id="toggleToRegister">
          Don’t have an account? <span class="font-semibold text-primary-green underline">Register</span>
        </div>
        <div class="toggle text-sm cursor-pointer text-gray-400 hover:text-primary-green hidden" id="toggleToLogin">
          Already registered? <span class="font-semibold text-primary-green underline">Login</span>
        </div>
      </div>
    </div>
  </div>

<script>
const API_BASE = "https://smartstock-qre1.onrender.com";

// === Utility Functions ===
function showAlert(message) {
  alert(message);
}

function showLoader(message = "Connecting to SmartStock...") {
  const loader = document.getElementById("loadingOverlay");
  if (loader) {
    loader.style.display = "flex";
    const textNode = loader.querySelector(".text-white");
    if (textNode) textNode.textContent = message;
    loader.classList.remove("opacity-0");
  }
}

function hideLoader() {
  const loader = document.getElementById("loadingOverlay");
  if (loader) {
    loader.classList.add("opacity-0");
    setTimeout(() => (loader.style.display = "none"), 400);
  }
}

// === Register ===
async function registerUser() {
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();

  if (!email || !password) {
    return showAlert("Please fill in all fields.");
  }

  showLoader("Registering user...");
  try {
    const res = await fetch(`${API_BASE}/register`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password }),
    });

    const data = await res.json();
    if (!res.ok) throw new Error(data.detail || "Registration failed");
    showAlert("Registration successful! You can now log in.");
  } catch (err) {
    console.error(err);
    showAlert("⚠️ Registration failed.");
  } finally {
    hideLoader();
  }
}

// === Login ===
async function loginUser() {
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();

  if (!email || !password) {
    return showAlert("Please enter both email and password.");
  }

  showLoader("Logging in...");
  try {
    const res = await fetch(`${API_BASE}/login`, {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: new URLSearchParams({ username: email, password }),
    });

    const data = await res.json();
    if (!res.ok) throw new Error(data.detail || "Login failed");

    localStorage.setItem("access_token", data.access_token);
    localStorage.setItem("refresh_token", data.refresh_token);
    localStorage.setItem("email", email);

    window.location.href = "dashboard.html";
  } catch (err) {
    console.error(err);
    showAlert("⚠️ Invalid credentials or server issue.");
  } finally {
    hideLoader();
  }
}

document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("loginBtn")?.addEventListener("click", loginUser);
  document.getElementById("registerBtn")?.addEventListener("click", registerUser);
});

</script>

    
</body>
</html>


