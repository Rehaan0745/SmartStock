<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SmartStock - Secure Login</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        'primary-green': '#10B981',
        'dark-bg': '#0F172A',
        'card-bg': '#1E293B',
      },
      fontFamily: {
        sans: ['Inter', 'sans-serif'],
      },
    }
  }
}
</script>
<style>
body {
  font-family: 'Inter', sans-serif;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  background-color: #0F172A;
}

/* Ghost styling */
.ghost {
  width: 100px;
  height: 100px;
  background: #10B981;
  border-radius: 50% 50% 0 0;
  position: relative;
  margin: 20px auto 40px;
  overflow: hidden;
  box-shadow: 0 5px 15px rgba(16,185,129,0.4);
}
.ghost::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 20px;
  background: #10B981;
  clip-path: polygon(0% 0%, 15% 100%, 30% 0%, 50% 100%, 70% 0%, 85% 100%, 100% 0%);
}
.eye {
  width: 30px;
  height: 30px;
  background: white;
  border-radius: 50%;
  position: absolute;
}
.pupil {
  width: 10px;
  height: 10px;
  background: #0F172A;
  border-radius: 50%;
  position: absolute;
  transition: transform 0.2s;
}
</style>
</head>
<body>
  <div class="w-full max-w-sm">
    <div class="bg-card-bg p-8 rounded-xl shadow-2xl border-t-4 border-primary-green">
      <!-- Ghost -->
      <div class="ghost" id="ghost">
        <div class="eye" id="eyeLeft" style="left:20px;top:20px;">
          <div class="pupil" id="pupilLeft" style="left:10px;top:10px;"></div>
        </div>
        <div class="eye" id="eyeRight" style="left:50px;top:20px;">
          <div class="pupil" id="pupilRight" style="left:10px;top:10px;"></div>
        </div>
      </div>

      <h1 class="text-3xl font-extrabold text-white mb-2 text-center">SmartStock Access</h1>
      <p id="formTitle" class="text-xl font-semibold text-primary-green mb-6 text-center">Login</p>

      <!-- Message -->
      <div id="message-box" class="hidden p-3 mb-4 rounded-lg text-sm font-medium" role="alert"></div>
      <!-- Login Form -->
      <form id="loginForm" onsubmit="handleLogin(event)" class="space-y-4">
        <input id="username" type="text" placeholder="Username" required 
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-green focus:border-primary-green" />
        <input id="password" type="password" placeholder="Password" required 
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-green focus:border-primary-green" />
        <button type="submit" 
          class="w-full py-2 px-4 rounded-md font-medium text-white bg-primary-green hover:bg-emerald-600 transition">
          Login
        </button>
      </form>

      <!-- Register Form -->
      <form id="registerForm" onsubmit="handleRegister(event)" class="space-y-4 hidden">
        <input id="regEmail" type="email" placeholder="Email" required 
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-green focus:border-primary-green" />
        <input id="regUsername" type="text" placeholder="Username" required 
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-green focus:border-primary-green" />
        <input id="regPassword" type="password" placeholder="Password" required 
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-green focus:border-primary-green" />
        <button type="submit" 
          class="w-full py-2 px-4 rounded-md font-medium text-white bg-primary-green hover:bg-emerald-600 transition">
          Register
        </button>
      </form>

      <!-- Toggle -->
      <div class="mt-4 text-center">
        <div class="toggle text-sm cursor-pointer text-gray-400 hover:text-primary-green" id="toggleToRegister">
          Don‚Äôt have an account? <span class="font-semibold text-primary-green underline">Register</span>
        </div>
        <div class="toggle text-sm cursor-pointer text-gray-400 hover:text-primary-green hidden" id="toggleToLogin">
          Already registered? <span class="font-semibold text-primary-green underline">Login</span>
        </div>
      </div>
    </div>
  </div>

<script>
// --- login.js ---
// Handles login form, ghost animation, and token storage

const loginForm = document.getElementById("loginForm");
const ghost = document.querySelector(".ghost");
const eyes = document.querySelectorAll(".eye");
const emailInput = document.getElementById("email");
const passwordInput = document.getElementById("password");

const API_BASE = "http://127.0.0.1:8000";

// üëÅ Ghost eyes follow cursor
document.addEventListener("mousemove", (e) => {
  eyes.forEach((eye) => {
    const rect = eye.getBoundingClientRect();
    const x = rect.left + rect.width / 2;
    const y = rect.top + rect.height / 2;
    const rad = Math.atan2(e.pageX - x, e.pageY - y);
    const rot = rad * (180 / Math.PI) * -1 + 180;
    eye.style.transform = `rotate(${rot}deg)`;
  });
});

// üëª Ghost hides on focus
[ emailInput, passwordInput ].forEach((input) => {
  input.addEventListener("focus", () => {
    ghost.classList.add("hide");
  });
  input.addEventListener("blur", () => {
    ghost.classList.remove("hide");
  });
});

// ü™™ Login form submission
loginForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  const email = emailInput.value.trim();
  const password = passwordInput.value.trim();

  if (!email || !password) {
    alert("Please fill all fields.");
    return;
  }

  try {
    const res = await fetch(`${API_BASE}/login`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password }),
    });

    if (!res.ok) {
      const err = await res.json();
      throw new Error(err.detail || "Login failed");
    }

    const data = await res.json();
    localStorage.setItem("token", data.access_token);
    localStorage.setItem("user", JSON.stringify(data.user));
    window.location.href = "dashboard.html";
  } catch (error) {
    console.error("Login Error:", error);
    alert(`‚ö†Ô∏è ${error.message}`);
  }
});
// --- verify.js ---
// Ensures user is authenticated before loading dashboard

const API_BASE = "http://127.0.0.1:8000";

async function verifyAuth() {
  const token = localStorage.getItem("token");
  if (!token) {
    alert("Session expired. Please log in again.");
    window.location.href = "login.html";
    return;
  }

  try {
    const res = await fetch(`${API_BASE}/verify`, {
      method: "GET",
      headers: {
        "Authorization": `Bearer ${token}`,
      },
    });

    if (!res.ok) {
      localStorage.removeItem("token");
      localStorage.removeItem("user");
      alert("Authentication failed. Please log in again.");
      window.location.href = "login.html";
    }
  } catch (err) {
    console.error("Verify Error:", err);
    alert("‚ö†Ô∏è Cannot connect to backend.");
    window.location.href = "login.html";
  }
}

verifyAuth();


</script>

    
</body>
</html>


