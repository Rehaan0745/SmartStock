<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SmartStock - Secure Login</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        'primary-green': '#10B981',
        'dark-bg': '#0F172A',
        'card-bg': '#1E293B',
      },
      fontFamily: {
        sans: ['Inter', 'sans-serif'],
      },
    }
  }
}
</script>
<style>
body {
  font-family: 'Inter', sans-serif;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  background-color: #0F172A;
}

/* Ghost styling */
.ghost {
  width: 100px;
  height: 100px;
  background: #10B981;
  border-radius: 50% 50% 0 0;
  position: relative;
  margin: 20px auto 40px;
  overflow: hidden;
  box-shadow: 0 5px 15px rgba(16,185,129,0.4);
}
.ghost::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 20px;
  background: #10B981;
  clip-path: polygon(0% 0%, 15% 100%, 30% 0%, 50% 100%, 70% 0%, 85% 100%, 100% 0%);
}
.eye {
  width: 30px;
  height: 30px;
  background: white;
  border-radius: 50%;
  position: absolute;
}
.pupil {
  width: 10px;
  height: 10px;
  background: #0F172A;
  border-radius: 50%;
  position: absolute;
  transition: transform 0.2s;
}
</style>
</head>
<body>
  <div class="w-full max-w-sm">
    <div class="bg-card-bg p-8 rounded-xl shadow-2xl border-t-4 border-primary-green">
      <!-- Ghost -->
      <div class="ghost" id="ghost">
        <div class="eye" id="eyeLeft" style="left:20px;top:20px;">
          <div class="pupil" id="pupilLeft" style="left:10px;top:10px;"></div>
        </div>
        <div class="eye" id="eyeRight" style="left:50px;top:20px;">
          <div class="pupil" id="pupilRight" style="left:10px;top:10px;"></div>
        </div>
      </div>

      <h1 class="text-3xl font-extrabold text-white mb-2 text-center">SmartStock Access</h1>
      <p id="formTitle" class="text-xl font-semibold text-primary-green mb-6 text-center">Login</p>

      <!-- Message -->
      <div id="message-box" class="hidden p-3 mb-4 rounded-lg text-sm font-medium" role="alert"></div>
      <!-- Login Form -->
      <form id="loginForm" onsubmit="handleLogin(event)" class="space-y-4">
        <input id="username" type="text" placeholder="Username" required 
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-green focus:border-primary-green" />
        <input id="password" type="password" placeholder="Password" required 
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-green focus:border-primary-green" />
        <button type="submit" 
          class="w-full py-2 px-4 rounded-md font-medium text-white bg-primary-green hover:bg-emerald-600 transition">
          Login
        </button>
      </form>

      <!-- Register Form -->
      <form id="registerForm" onsubmit="handleRegister(event)" class="space-y-4 hidden">
        <input id="regEmail" type="email" placeholder="Email" required 
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-green focus:border-primary-green" />
        <input id="regUsername" type="text" placeholder="Username" required 
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-green focus:border-primary-green" />
        <input id="regPassword" type="password" placeholder="Password" required 
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-green focus:border-primary-green" />
        <button type="submit" 
          class="w-full py-2 px-4 rounded-md font-medium text-white bg-primary-green hover:bg-emerald-600 transition">
          Register
        </button>
      </form>

      <!-- Toggle -->
      <div class="mt-4 text-center">
        <div class="toggle text-sm cursor-pointer text-gray-400 hover:text-primary-green" id="toggleToRegister">
          Don‚Äôt have an account? <span class="font-semibold text-primary-green underline">Register</span>
        </div>
        <div class="toggle text-sm cursor-pointer text-gray-400 hover:text-primary-green hidden" id="toggleToLogin">
          Already registered? <span class="font-semibold text-primary-green underline">Login</span>
        </div>
      </div>
    </div>
  </div>

<script>
const ghost = document.getElementById('ghost');
const pupilLeft = document.getElementById('pupilLeft');
const pupilRight = document.getElementById('pupilRight');
const passwordInput = document.getElementById('password');
const regPasswordInput = document.getElementById('regPassword');
const loginForm = document.getElementById('loginForm');
const registerForm = document.getElementById('registerForm');
const toggleToRegister = document.getElementById('toggleToRegister');
const toggleToLogin = document.getElementById('toggleToLogin');
const messageBox = document.getElementById('message-box');

// üëª Ghost eye tracking
document.addEventListener('mousemove', e => {
  const rect = ghost.getBoundingClientRect();
  const x = e.clientX - (rect.left + rect.width / 2);
  const y = e.clientY - (rect.top + rect.height / 2);
  const angle = Math.atan2(y, x);
  const move = 3;
  const xMove = Math.cos(angle) * move;
  const yMove = Math.sin(angle) * move;
  [pupilLeft, pupilRight].forEach(p => {
    p.style.left = `${10 + xMove}px`;
    p.style.top = `${10 + yMove}px`;
  });
});

// üëÅÔ∏è Shrink eyes when typing password
const shrink = () => [pupilLeft, pupilRight].forEach(p => p.style.transform = 'scale(0.1)');
const restore = () => [pupilLeft, pupilRight].forEach(p => p.style.transform = 'scale(1)');
passwordInput.addEventListener('focus', shrink);
passwordInput.addEventListener('blur', restore);
regPasswordInput.addEventListener('focus', shrink);
regPasswordInput.addEventListener('blur', restore);

// üîÅ Toggle between forms
toggleToRegister.onclick = () => {
  loginForm.classList.add('hidden');
  registerForm.classList.remove('hidden');
  toggleToRegister.classList.add('hidden');
  toggleToLogin.classList.remove('hidden');
};
toggleToLogin.onclick = () => {
  registerForm.classList.add('hidden');
  loginForm.classList.remove('hidden');
  toggleToLogin.classList.add('hidden');
  toggleToRegister.classList.remove('hidden');
};

// üì¢ Message display helper
const showMessage = (type, text) => {
  messageBox.textContent = text;
  messageBox.classList.remove('hidden');
  messageBox.style.background = type === 'success' ? '#DCFCE7' : '#FEE2E2';
  messageBox.style.color = type === 'success' ? '#166534' : '#991B1B';
};

// üåç Backend base URL (deployed backend)
const BASE_URL = 'https://smartstock-qre1.onrender.com';

// üü¢ Register
async function handleRegister(e) {
  e.preventDefault();
  const email = document.getElementById('regEmail').value.trim();
  const username = document.getElementById('regUsername').value.trim();
  const password = document.getElementById('regPassword').value.trim();

  try {
    const res = await fetch(`${BASE_URL}/register`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, username, password })
    });

    const data = await res.json();
    if (res.ok) {
      showMessage('success', '‚úÖ Registration successful! Please log in.');
      toggleToLogin.click();
    } else {
      showMessage('error', data.detail || 'Registration failed.');
    }
  } catch (err) {
    console.error(err);
    showMessage('error', '‚ö†Ô∏è Server unreachable.');
  }
}

// üîê Login (JWT)
async function handleLogin(e) {
  e.preventDefault();
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value.trim();
  if (!username || !password) return showMessage('error', 'Enter both username and password.');

  try {
    const res = await fetch(`${BASE_URL}/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username, password })
    });

    const data = await res.json();
    if (res.ok && data.access_token) {
      showMessage('success', `Welcome, ${data.username}! Redirecting...`);
      localStorage.setItem('access_token', data.access_token);
      localStorage.setItem('refresh_token', data.refresh_token);
      localStorage.setItem('username', data.username);
      localStorage.setItem('user_id', data.user_id);
      setTimeout(() => window.location.replace('dashboard.html'), 1500);
    } else {
      showMessage('error', data.detail || 'Invalid credentials.');
    }
  } catch (err) {
    console.error(err);
    showMessage('error', '‚ö†Ô∏è Cannot connect to backend.');
  }
}

// ‚ú≥Ô∏è Bind submit handlers
document.getElementById('loginForm').addEventListener('submit', handleLogin);
document.getElementById('registerForm').addEventListener('submit', handleRegister);
</script>

    
</body>
</html>

